{% extends "base.html" %}
{% load staticfiles mathfilters django_tables2 %}


{% block content %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/sweetalert.css' %}">
{% endblock %}



<div class="teamPage">
  {% include "sidebar.html" %}
  <div class="col-lg-10" id="teamInfo">
    <div class="col-lg-12 statcard" id="teamName">
      <h1 class="teamNameHeader">{{ team.team_name }}</h1>
      {% if not request.user.is_anonymous %}
        {% if rank in userTeam.getChallengers and canChallenge %}
        <a href="{% url 'challenge_arg' team.team_name %}" class="btn btn-primary btn-lg" role="button" >Challenge</a><br><br>
        {% elif team.team_name != request.user.team and request.user.username != 'admin'  %}
        <button type="button" class="btn btn-lg btn-primary" disabled>Challenge</button><br><br>
        {% else %}
        {% endif %}
      {% endif %}
      <table class="subTeamName" align='center'>
        <tr>
          <th class="subTeamNameRow">
            {{ team.rank }}{% if team.rank == 3 %}rd{% elif team.rank == 2 %}nd{% elif team.rank == 1 %}st{% else %}th{% endif %}</th>
          <th class="subTeamNameRow">
            <img class="crown" src="{% static 'img/crown.png' %}" width="16px" height="16px"/>{{ team.captain }}</th>
          <th class="subTeamNameRow">{{ team.abv }}</th>
          {% if not request.user.is_anonymous and request.user.pk != team.captain.user.pk %}
          <th class="subTeamNameRow" >{{ team.get_server_display }}</th>
          <th class="subTeamNameRow" id="subTeamServer">
            <a href="{% url 'postman:write' team.captain %}?subject=USC Challenge"><img class="crown" src="{% static 'img/message_icon.png' %}" width="16px" height="16px"/></th>
          {% else %}
          <th class="subTeamNameRow" id="subTeamServer">{{ team.get_server_display }}</th>
          {% endif %}
        </tr>
      </table>
      {% render_table table %}
    </div>
    <div class="col-lg-3">
      <div class="statcard">
        <div class="roster">
          <div class="smallCardHeader">
            Roster
          </div>

          <table class="rosterTable">
            <!-- <button style="float:right;border:1px grey solid;font-size:12px;background-color:white;margin-right:5px;">edit</button> -->
              <!-- <tr style="float:right;"><td style="border:none;font-size:12px;margin-right:5px;background-color:white;"></td></tr> -->
            <form action="#" method="get">
              <!-- Captain -->
              <tr>
                <td class="rosterInfo"><a class="player" href="{% url 'player' team team.captain %}">{{ team.captain }}</a></td>
                <td class="dropPlayer" title="Drop Player"><button id="dropButton" class="btn btn-danger btn-sm">x</button></td>
              </tr>
              <!-- Co-Captain -->
              {% if team.co_captain %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.co_captain %}">{{ team.co_captain }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.co_captain }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.co_captain }}" >x</button>
                </tr>
              {% else %}
                <!-- <tr><td>add player</td><tr> -->
                <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member1 -->
              {% if team.member1 %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member1 %}">{{ team.member1 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member1 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member1 }}" >x</button>
                </tr>
              {% else %}
                <!-- <tr><td>add player</td><tr> -->
                <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member2 -->
              {% if team.member2 %}
                {% if team.member2.user.username != team.captain.name %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member2 %}">{{ team.member2 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member2 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member2 }}" >x</button>
                </tr>
                {% endif %}
              {% else %}
                <!-- <tr><td>add player</td><tr> -->
                <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member3 -->
              {% if team.member3 %}
                {% if team.member3.user.username != team.captain.name %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member3 %}">{{ team.member3 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member3 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member3 }}" >x</button>
                </tr>
                {% endif %}
              {% else %}
                <!-- <tr><td>add player</td><tr> -->
                <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member4 -->
              {% if team.member4 %}
                {% if team.member4.user.username != team.captain.name %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member4 %}">{{ team.member4 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member4 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member4 }}" >x</button>
                </tr>
                {% endif %}
              {% else %}
              <!-- <tr><td>add player</td><tr> -->
              <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member5 -->
              {% if team.member5 %}
                {% if team.member5.user.username != team.captain.name %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member5 %}">{{ team.member5 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member5 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member5 }}" >x</button>
                </tr>
                {% endif %}
              {% else %}
              <!-- <tr><td class="addPlayer" title="Add Player"><button class="addButton" onclick="location.href='{% url 'add_player' team %}';">add player</button></td><tr> -->
              <tr><td style="border:none;">—</td></tr>
              {% endif %}
              <!-- Member6 -->
              {% if team.member6 %}
                {% if team.member6.user.username != team.captain.name %}
                <tr>
                  <td class="rosterInfo"><a class="player" href="{% url 'player' team team.member6 %}">{{ team.member6 }}</a></td>
                  <td class="dropPlayer" title="Drop {{ team.member6 }}"><button id="dropButton" class="btn btn-danger btn-sm" value="{{ team.member6 }}">x</button>
                </tr>
                {% endif %}
              {% else %}
              <tr><td style="border:none;">—</td></tr>
              <!-- <tr><td class="addPlayer" title="Add Player"><a href="{% url 'add_player' team %}" class="addButton">add player</a></td><tr> -->
              {% endif %}
            </form>
          </table>
          <hr class="rosterDivider">
          <div class="addDropButtons">
            <span class="input-group-btn">
              <button type="button" id="drop_button"class="btn btn-danger btn-number" data-type="plus" data-field="quant[2]">
                  <span class="glyphicon glyphicon-plus">-</span>
              </button>
            </span>
            <span class="input-group-btn">
              <button type="button" id="add_button" class="btn btn-success btn-number" data-type="plus" data-field="quant[2]">
                  <span class="glyphicon glyphicon-plus">+</span>
              </button>
            </span>
            <!-- <button class="test">+</button>
            <button class="test">-</button> -->
          </div>

        </div>
      </div>
    </div>
    <div class="col-lg-6 ">
      <div class="statcard">
        <div class="teamsToChallenge">
          <div class="smallCardHeader">Current Challenges</div>
          <table class="challengeTable">
            {% if not currentChallenges|length_is:"0" or not currentChallenges|length_is:"0" %}
            <tr>
              <th class="challengeHeader">Challenger</th>
              <th class="challengeHeader">Challenged</th>
              <th class="challengeHeader">Map</th>
              <th class="challengeHeader">Challenge Date</th>
              <th class="challengeHeader">Forfeit Date </th>
              <th class="challengeHeader">Void Date </th>
            </tr>
            {% for challenge in currentChallenges %}
            <tr class="currentChallengesRow">
              <td class="challengeRow"><a href="{% url 'team' challenge.challenger.team_name %}">{{ challenge.challenger.team_name }}</a><br></td>
              <td><a href="{% url 'team' challenge.challenged.team_name %}">{{ challenge.challenged.team_name }}</a><br></td>
              <td>{{ challenge.map }}</td>
              <td>{{ challenge.challenge_date.month }}/{{ challenge.challenge_date.day }}/{{ challenge.challenge_date.year|sub:2000 }}</td>
              <td>{{ challenge.forfeit_date.month }}/{{ challenge.forfeit_date.day }}/{{ challenge.forfeit_date.year|sub:2000 }}</td>
              <td>{{ challenge.void_date.month }}/{{ challenge.void_date.day }}/{{ challenge.void_date.year|sub:2000 }}</td>
              {% if team.team_name == request.user.team %}
              <td style="border:none;background-color:white;display: block;"><a style="color:indianred;font-size:12px;padding-left:5px;" href="{% url 'forfeit' challenge.id %}" onclick="return confirm('Are you sure want to forfeit?');">forfeit?</a></td>
              <td style="border:none;background-color:white;display: block;"><a style="color:cornflowerblue;font-size:12px;padding-left:5px;" href="{% url 'submit' challenge.id %}">submit</a></td>
              {% endif %}
            </tr>
            {% endfor %}
            {% else %}
            <tr><td class="challengeRow">No current challenges!</td></tr>
            {% endif %}
          </table>
        </div>
      </div>
      <div class="statcard">
        <div class="teamsToChallenge">
          <div class="smallCardHeader">Teams to Challenge</div>
          <table class="challengeTable">
            {% if not challengersList == None and not challengersList|length_is:"0" %}
            <tr>
  						<th class="challengeHeader" id="challengeRank">Rank</th>
              <th class="challengeHeader" id="challengeTeam">Team</th>
              <th class="challengeHeader">Challenges In</th>
              <th class="challengeHeader">Challenges Out</th>
              <th class="challengeHeader">Streak</th>
              <th class="challengeHeader">Last Active</th>
            </tr>
            {% for rank,roster in challengersList.items %}
            <tr class="currentChallengesRow">
              <td class="challengeRow" id="challengeCellRank">{{ rank }}</td>
              <td class="challengeRow" id="challengeCellTeam"><a class="challengeTeamLink" href="{% url 'team' roster.team %}">{{ roster.team }}</a><br></td>
              <td class="challengeRow" id="challengeCellIn" {% if roster.challengeIn == 2 %}style="color:red;"{% endif %}>
                {{ roster.challengeIn }}</td>
              <td class="challengeRow" >
                {{ roster.challengeOut }}</td>
              <td class="challengeRow">
                {% if roster.streak < 0 %}{{ roster.streak|abs }}L
                {% elif roster.streak > 0 %}{{ roster.streak }}W
                {% else %}--{% endif %}
              </td>
              <td class="challengeRow">{% if roster.lastActive %}{{ roster.lastActive.month }}/{{ roster.lastActive.day }}/{{ roster.lastActive.year|sub:2000 }}{% else %}--{% endif %}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr><td class="challengeRow">You can't challenge anyone!</td></tr>
            {% endif %}
          </table>
        </div>
      </div>
    </div>
    <!--  -->
    <div class="col-lg-3">
      <div class="statcard">
        <div class="recentGames">
          <div class="smallCardHeader">Recent Games</div>
          {% for game in recentGames %}
          <div class="gameLogoContainer">
            <img class="gameLogo" src="{% static 'img/boostin_dynamo.png' %}"/>
            <table class="scheduleScores">
              <tr>
                <td>{{ game.challenger }}</td>
                <td>{% if game.g1_results.team1 == game.challenger.abv %}
                  {{ game.g1_results.score1 }}
                  {% else %}
                  {{ game.g1_results.score2 }}
                  {% endif %}
                </td>
                <td>{% if game.g2_results.team1 == game.challenger.abv %}
                  {{ game.g2_results.score1 }}
                  {% else %}
                  {{ game.g2_results.score2 }}
                  {% endif %}
                </td>
              </tr>
              <tr>
                <td>{{ game.challenged }}</td>
                <td>{% if game.g1_results.team1 == game.challenged.abv %}
                  {{ game.g1_results.score1 }}
                  {% else %}
                  {{ game.g1_results.score2 }}
                  {% endif %}
                </td>
                <td>{% if game.g2_results.team1 == game.challenged.abv %}
                  {{ game.g2_results.score1 }}
                  {% else %}
                  {{ game.g2_results.score2 }}
                  {% endif %}
                </td>
              </tr>
            </table>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

<script src="{% static 'js/drop_player.js' %}"></script>
<script>

$("#add_button").click(function(){
  event.preventDefault()
  swal({
    title: "Add a player!",
    text: "Write the player's name:",
    type: "input",
    showCancelButton: true,
    closeOnConfirm: false,
    animation: "slide-from-top",
    inputPlaceholder: "i.e. Rattpack"
  },
  function(inputValue){
    if (inputValue === false) return false;

    if (inputValue === "") {
      swal.showInputError("You need to write something!");
      return false
    }
    $.post({
        url: {% url 'add_player' %},
        success: function() {
           swal("Nice!", "You wrote: " + inputValue, "success");
        }
    });
  });
});

{% if stats.streak < 0 %}$('#streak').attr('id', 'negative');{% elif stats.streak > 0 %}$('#streak').attr('id', 'positive');{% else %}{% endif %}
{% if stats.challengeOut == 2 %}$('#challengeOut').attr('id', 'negative');{% endif %}
{% if stats.challengeIn == 2 %}$('#challengeIn').attr('id', 'negative');{% endif %}
{% if stats.highestRank > 0 and stats.highestRank < 6 %}$('#highestRank').attr('id', 'diamond');
{% elif stats.highestRank >= 6 and stats.highestRank < 21 %}$('#highestRank').attr('id', 'gold');
{% elif stats.highestRank >= 21 and stats.highestRank < 36 %}$('#highestRank').attr('id', 'silver');
{% elif stats.highestRank >= 36 %}$('#highestRank').attr('id', 'bronze');{% endif %}
{% if stats.change < 0 %}
  $('#change').attr('id','negative').replaceWith('<td class="change" id="negative">' + '▼' + String({{ stats.change|abs }}) + '</td>');{% endif %}
{% if stats.change %}
  $('#change').attr('id','positive').replaceWith('<td class="change" id="positive">' + '▲' + String({{ stats.change }}) + '</td>');{% endif %}
</script>

{% endblock %}
